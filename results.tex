\chapter{Results}
\label{chap: results}

% TABLE
\begin{table}
\resizebox{\columnwidth}{!}{%
\begin{tabular}{|l|rr|rr|r||rr|rr|r||rr|rr|r|}
\hline
 & \multicolumn{15}{c|}{ \#S }\\
\hline
\#Solutions & \multicolumn{5}{c||}{ k=2 } & \multicolumn{5}{c||}{ k=4 } & \multicolumn{5}{c|}{ k=8 }\\
\hline
Transitivity & \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c||}{ \#N }
& \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c||}{ \#N } 
& \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c|}{ \#N }\\
\hline
Compatibility & \multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c||}{-} & 
\multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c||}{-} & 
\multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c|}{-}\\ 
\hline
crewplanning(30) & 5 & 5 & 5 & 5 & 25 & 5 & 5 & 5 & 5 & 25 & 2 & 0 & 3 & 1 & 22 \\ 
parking(10) & 8 & 8 & 8 & 8 & 9 & 9 & 9 & 9 & 9 & 9 & 6 & 6 & 6 & 6 & 6 \\ 
quantum circuit(10) & 5 & 5 & 5 & 5 & 8 & 5 & 5 & 5 & 5 & 6 & 5 & 5 & 5 & 5 & 5 \\
trucks(10) & 8 & 8 & 8 & 8 & 10 & 10 & 9 & 10 & 10 & 10 & 8 & 8 & 9 & 9 & 10 \\ 
turn and open(20) & 2 & 2 & 2 & 2 & 2 & 1 & 1 & 1 & 1 & 1 & 0 & 0 & 1 & 0 & 1 \\ 
\hline
Total  & 28 & 28 & 28 & 28 & 54 & 30 & 29 & 30 & 30 & 51 & 21 & 19 & 24 & 21 & 44\\
\hline
\end{tabular}
}
\caption{Empirical results table: Success Counts}
\label{table: results - success}
\end{table}

\begin{table}
\resizebox{\columnwidth}{!}{%
\begin{tabular}{|l|rr|rr|r||rr|rr|r||rr|rr|r|}
\hline
    & \multicolumn{15}{c|}{Compactness}\\
\hline
\#Solutions & \multicolumn{5}{c||}{ k=2 } & \multicolumn{5}{c||}{ k=4 } & \multicolumn{5}{c|}{ k=8 }\\
\hline
Transitivity &  \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c||}{ \#P } 
& \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c||}{ \#P }
& \multicolumn{2}{c|}{ St } & \multicolumn{2}{c|}{ L } & \multicolumn{1}{c|}{ \#P }\\
\hline
Compatibility & \multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c||}{-} & 
\multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c||}{-} & 
\multicolumn{1}{c}{F} & \multicolumn{1}{c}{S} & \multicolumn{1}{c}{F} & \multicolumn{1}{c|}{S} &
\multicolumn{1}{c|}{-}\\ 
\hline
crewplanning(30) & 0.017 & 0.116 & 0.017 & 0.113 & 5 & 0.185 & 0.175 & 0.185 & 0.178 & 5 & - & - & - & - & 0 \\
parking(10) & 0.042 & 0.042 & 0.042 & 0.042 & 8 & 0.09 & 0.098 & 0.09 & 0.098 & 9 & 0.117 & 0.122 & 0.102 & 0.111 & 6\\
quantum circuit(10) &  0.035 & 0.035 & 0.035 & 0.035 & 5 & 0.072 & 0.072 & 0.072 & 0.079 & 5 & 0.131 & 0.126 & 0.066 & 0.075 & 5\\
trucks(10) &0.05 & 0.081 & 0.05 & 0.077 & 8 & 0.059 & 0.063 & 0.056 & 0.058 & 9 & 0.066 & 0.048 & 0.032 & 0.023 & 8 \\
turn and open(20) & 0.03 & 0.057 & 0.03 & 0.065 & 2 & 0.16 & 0.043 & 0.014 & 0.02 & 1 & - & - & - & - & 0 \\
\hline
Average & 0.035 & 0.066 & 0.035 & 0.066 & 28 & 0.113 & 0.09 & 0.083 & 0.087 & 29 & 0.105 & 0.099 &	0.067 &	0.07 & 19\\ 
\hline
\end{tabular}
}
\caption{Empirical results table: Compactness Scores}
\label{table: results - compactness}
\end{table}



\section{Empirical Evaluation}
In order to empirically evaluate our algorithm, our compilation takes a temporal planning task $\Pi$ and generates a set of $k$ diverse solutions using the plan elimination compilation described in Section 4, with OPTIC \cite{benton2012temporal} as the underlying solver. The TPS of each solution is obtained and $\MergeSet$ is computed, containing all the compatible time point pairs found in the naive TPN.
We then construct a COP based on $\MergeSet$ in Minizinc \cite{nethercote2007minizinc} and use Gecode \cite{gecode} to solve it. As output, we receive a mapping from time point pairs to merge operations resulting in a new TPN.
%which has been optimized for compactness. 
If no compatible pairs are found (i.e. $\MergeSet = \emptyset$) the naive TPN is returned as output. 


We evaluated all combinations of $k$ chosen from $\{2,4,8\}$, and both compatibility methods 
(Full \& Semi denoted as F,S) and merging transitivity (Strict \& Loose denoted as St,L). Thus, for each problem, we ran the diverse planner 3 times (for the different values of $k$), and then ran 4 different versions of our COP (for the different compatibility and transitivity). The experiments were performed on Intel i7-7700K 32GB RAM, with a time limit of 30min for generating the diverse solutions and 5min for the COP task.
Surpassing the 30min time limit for obtaining diverse solutions results in a failed run, while surpassing the 5min limit on the COP results in the best solution found so far (not necessarily an optimal solution) or the naive TPN if no solution at all was found in this time.
 


We evaluated our approach on all domains from the temporal track IPC in 2011, 2014, and 2018. Of these, we eliminated domains with actions whose durations depend on the current state, as this is not supported in a TPN.
Out of these, we kept the domains where OPTIC was able to retrieve multiple diverse solutions for more than a single problem.

We define a run on a specific problem to be successful if:
\begin{enumerate}[label=(\roman*)]
    \item OPTIC is able to obtain $k$
diverse solutions to the problem and
 \item the generated TPN is more compact than the naive TPN.
\end{enumerate}
% \textit{i)}  \textit{ii)} 
Otherwise, although the algorithm might have terminated successfully, we do not count it.
Such a scenario occurs when the generated solutions in $\Pi$ are very different from one another 
and no compatible pairs are found between them, leading to no possible merges to the naive TPN.\\
\\
Table \ref{table: results - success} showcases the number of problems for which we were
able to obtain $k$ solutions as \#N, and the number of successful runs as \#S.
\\
Table \ref{table: results - compactness} reports by how much our approach was able to reduce the size 
of the naive TPN. As different values of $k$ for the same problem lead to different sizes of the naive TPN, 
we evaluate the compactness of the generated TPN relative to the size of the naive 
TPN: 
\[compactness(TPN) = 1 - \frac{|\mathcal{E}_{new}|}{|\mathcal{E}_{naive}|}\]

We show the average compactness over the commonly solved problems for each $k$ by the four different 
configurations of our approach. \#P denotes the number of commonly solved problems for each $k$.
\\ \\
Before we analyze the results, we note that the larger $k$ is, the more IHs we have to compare between diverse solutions.
Therefore we expect that an increase in $k$ will result in more compatible pairs and thus in more merges and better compactness, but at the cost of more computational effort. 

\section{Results Discussion}
Let us observe Tables \ref{table: results - success} \& \ref{table: results - compactness} and compare them to our intuition.

First off we notice in Table \ref{table: results - success} that the overall number of success decreases for a large $k$. This is according to our intuition and can be explained by the rise in complexity of the COP due to many compatible pairs and the associated high memory consumption.
However, if we look closely, we notice that on the other extreme, when $k$ is low there is a greater probability that the few diverse solutions generated will differ significantly from one another. In such a case it becomes possible that no compatible pairs are found all together, thus resulting in an unsuccessful run.
In other words, a very low $k$ may also reduce the number of successes for a given problem.
Indeed, this is the case for both parking and trucks domains, where using $k=4$ resulted in more success than either $k=2$ or $k=8$.
\\ \\
We now turn out attention to examining the differences between the four configurations of our approach.

\paragraph{Compatibility}
First, let us remember that by definition semi-compatibility always results in at least as many compatible pairs as full-compatibility, i.e Full-compatibility $\subseteq$ Semi-compatibility. \\
This increase in the number of possibilities raises the complexity of solving the corresponding COP, which can explain the higher success count of the full-compatibility, as can be seen in Table \ref{table: results - success} for \textit{crewplanning} with $k=8$ and \textit{trucks} with $k=4$.

On the other hand, these extra possibilities allow for more merges, and thus for better compactness. This is especially evident for $k=2$, where a single merge contributes more to the compactness than for higher values of $k$, since it involves time points from a higher proportion of the original solutions. 

Another point to take into consideration is that by reducing the merge possibilities, the Full-compatibility configuration prunes the solution space, allowing the COP to focus on "good" solutions. This can be seen in Table \ref{table: results - compactness} for \textit{crewplanning} with $k=4$ and \textit{trucks} with $k=8$.

\paragraph{Transitivity}
When comparing strict transitivity to loose transitivity we remember that the former applies stricter constraints, thus pruning the space of possible solutions. With lower values of $k$, this pruning makes little difference, implying that the best solutions are not typically pruned by this. For higher values of $k$ this pruning reduces the size of the search space, allowing the solver to find better solutions in the allotted time, at the cost of a slight reduction in the success count. This is especially evident for $k=8$ where we can see in Table \ref{table: results - compactness} that strict transitivity results in higher compactness values of all domains, but in the meantime also produces less successes as can be seen in Table \ref{table: results - success}. 